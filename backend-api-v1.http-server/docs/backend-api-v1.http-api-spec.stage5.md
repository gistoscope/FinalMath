Backend API v1 — HTTP Contract Spec (Stage 5 Baseline) 2This document specifies the HTTP API contract for the Stage 5 baseline backend3. It is the authoritative description of available endpoints, request/response schemas, error formats and status codes4.1. Conventions 5All application endpoints (except /health) use JSON request bodies and JSON responses6.Character encoding: UTF-87.1.1 Common fields and typesSession identifiers (sessionId: string)8.Course identifiers (courseId: string)9.JWT tokens (token: string)10.Latex expressions (expressionLatex: string)11.Selection path (selectionPath: string | null)12.2. Authentication API2.1 POST /api/registerRegister a new user and automatically log them in13.Request Body: Requires username, password, role ("student" or "teacher")14.Success Response: Returns status: "ok", token: <jwt>, userId, and role15.Error: Returns status: "error" on missing fields or user already exists16.2.2 POST /api/loginAuthenticate an existing user and issue a JWT17.Request Body: Requires username, password18.Success Response: Returns status: "ok" and token: <jwt>19.3. Step Execution API3.1 POST /api/entry-stepRun one step of the engine pipeline20.Request Body: Includes sessionId, courseId, expressionLatex (required), selectionPath, policyId, and optional token21212121.Responses:status: "step-applied" (Success)22.status: "no-candidates" (Step not possible)23.status: "engine-error" (Math error)24.3.2 POST /api/undo-stepUndo the last successful step25.Request Body: Requires sessionId26.Responses: status: "undo-complete" or status: "no-history"272727.3.3 POST /api/hint-requestAsk the orchestrator for a hint28.Responses: status: "hint-found" (with hintText) or status: "no-hint"292929.4. Mapping Rules: EngineRequest → Backend APIEngineRequest.typeBackend endpointNotes"applyStep"POST /api/entry-stepMain step execution30."getHints"POST /api/hint-requestHint pipeline31."undoLastStep"POST /api/undo-stepUndo last step32."parse"No backend callAdapter echoes the input Latex33."previewStep"No backend callAdapter returns a local message ("Preview not implemented")34.5. Error HandlingAny non-2xx status, network failure, or JSON parse error from backend is mapped to a high-level EngineResponse.type: "error"35353535.Errors should include code: "backend-transport-error" and details36363636.2. Структура Папок для АдаптераРекомендация: Вам следует создать /adapter как отдельный, независимый проект (папка-сосед) рядом с вашим бэкендом:d:/MathMaster/Code/backend-api-v1.adapterПочему Sibling Project (Папка-Сосед)?Разделение Процессов: Адаптер — это отдельный сервис, который должен работать на другом порту (по умолчанию 4101 37), в то время как ваш бэкенд работает на 420138.Чистая Архитектура: Размещение адаптера внутри /src нарушит чистую модульность бэкенда. Адаптер — это тонкий внешний мост, а не часть ядра Оркестратора39.Конфигурация: Адаптер имеет свой собственный файл package.json и свои собственные переменные окружения (BACKEND_BASE_URL, ENGINE_ADAPTER_PORT)40.