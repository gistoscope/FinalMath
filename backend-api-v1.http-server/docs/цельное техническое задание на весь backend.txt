–ù–∏–∂–µ ‚Äî —Ü–µ–ª—å–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –≤–µ—Å—å backend, –∫–∞–∫ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç, –∞ –∑–∞—Ç–µ–º ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ –¢–ó –ø–æ –∫–∞–∂–¥–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É, —Ç–∞–∫, —á—Ç–æ–±—ã —ç—Ç–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –æ—Ç–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥–µ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –ø–æ —á–∞—Å—Ç—è–º.


–û–±–∑–æ—Ä

–°–¥–µ–ª–∞–µ–º –æ–¥–∏–Ω –æ–±—â–∏–π ¬´—Ä–µ–µ—Å—Ç—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤¬ª –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã: —Ñ—Ä–æ–Ω—Ç-—ç–Ω–¥, –∞–¥–∞–ø—Ç–µ—Ä—ã, –±—ç–∫-—ç–Ω–¥ –∏ —è–¥—Ä–æ. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ ‚Äî –∫–æ—Ä–æ—Ç–∫–æ–µ –±—ã—Ç–æ–≤–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –¥—É—Ö–µ MapMaster/StepMaster: —Ç–æ–ª—å–∫–æ ¬´—á—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç¬ª.

–ß—Ç–æ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å

–ü–µ—Ä–µ—á–∏—Å–ª—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ —Å–ª–æ—è–º (front-end ‚Üí –º–æ—Å—Ç ‚Üí backend API ‚Üí engine/–ª–æ–≥–∏–∫–∞). –≠—Ç–æ –º–æ–∂–Ω–æ –ø—Ä—è–º–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –≤ –¢–ó –∫–∞–∫ —Å–ª–æ–≤–∞—Ä—å.

üü¢ –î–µ–π—Å—Ç–≤–∏–µ ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –¢–ó –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º
1. –§—Ä–æ–Ω—Ç-—ç–Ω–¥: —Ç–æ, —á—Ç–æ –∂–∏–≤—ë—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ

AppShell (–æ–±–æ–ª–æ—á–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
–î–µ—Ä–∂–∏—Ç –æ–±—â–∏–π –∫–∞—Ä–∫–∞—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã: —à–∞–ø–∫—É, –ª–µ–≤—É—é/–ø—Ä–∞–≤—É—é –ø–∞–Ω–µ–ª–∏, –∑–æ–Ω—É —Ñ–æ—Ä–º—É–ª—ã –∏ –ø–∞–Ω–µ–ª—å –ø–æ–¥—Å–∫–∞–∑–æ–∫. –°–ª–µ–¥–∏—Ç, –∫–∞–∫–æ–π —Ä–µ–∂–∏–º —Å–µ–π—á–∞—Å –≤–∫–ª—é—á—ë–Ω (—É—á–µ–Ω–∏–∫, —É—á–∏—Ç–µ–ª—å, –∞–≤—Ç–æ–ø–∏–ª–æ—Ç).

Expression Viewer (–ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ —Ñ–æ—Ä–º—É–ª—ã)
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∫—Ä–∞—Å–∏–≤–æ (KaTeX –∏ —Ç.–ø.), –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É–ª—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –∏ –¥–∞—ë—Ç –±–∞–∑–æ–≤—ã–µ —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –Ω–∞–≤–µ–¥–µ–Ω–∏–µ –∏ –∫–ª–∏–∫.

Selection Layer (—Å–ª–æ–π –≤—ã–¥–µ–ª–µ–Ω–∏—è)
–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç–æ, —á—Ç–æ–±—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ —Å–∏–º–≤–æ–ª—É/—Ñ—Ä–∞–≥–º–µ–Ω—Ç—É —Ñ–æ—Ä–º—É–ª—ã –≤—ã–¥–µ–ª—è–ª—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫—É—Å–æ–∫ (—á–∏—Å–ª–æ, –¥—Ä–æ–±—å, —Å—É–º–º–∞, —Å–∫–æ–±–∫–∏) –∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–ª–æ—Å—å —Ç–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã.

Context Menu / Actions Panel (–º–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π)
–ö–æ–≥–¥–∞ —É—á–µ–Ω–∏–∫ –∫–ª–∏–∫–∞–µ—Ç –ø–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—é, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —à–∞–≥–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´—Å–æ–∫—Ä–∞—Ç–∏—Ç—å –¥—Ä–æ–±—å¬ª, ¬´—Ä–∞—Å–∫—Ä—ã—Ç—å —Å–∫–æ–±–∫–∏¬ª, ¬´—Å–ª–æ–∂–∏—Ç—å —ç—Ç–∏ –¥–≤–∞ —á–∏—Å–ª–∞¬ª).

Step Timeline (–ª–µ–Ω—Ç–∞ —à–∞–≥–æ–≤)
–•—Ä–∞–Ω–∏—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —É–∂–µ —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö —à–∞–≥–æ–≤: –∏—Å—Ö–æ–¥–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞, –∫–∞–∂–¥—ã–π –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —à–∞–≥ –∏ —Ç–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä–æ—Å–ª–µ–¥–∏—Ç—å –ø—É—Ç—å —Ä–µ—à–µ–Ω–∏—è.

Hint Panel (–ø–∞–Ω–µ–ª—å –ø–æ–¥—Å–∫–∞–∑–æ–∫)
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∫ —Ç–µ–∫—É—â–µ–º—É —à–∞–≥—É: —á—Ç–æ –º—ã —Å–µ–π—á–∞—Å –¥–µ–ª–∞–µ–º, –∑–∞—á–µ–º —ç—Ç–æ—Ç —à–∞–≥, –∫–∞–∫–æ–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –æ–±—ã—á–Ω–æ –±—ã–≤–∞–µ—Ç.

Teacher Mode UI (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É—á–∏—Ç–µ–ª—è)
–î–∞—ë—Ç —É—á–∏—Ç–µ–ª—é –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã: –≤—ã–±–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è, —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –≤–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ —à–∞–≥–æ–≤, –ø—Ä–æ—Å–º–æ—Ç—Ä ¬´–∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è¬ª.

Settings / Mode Switcher (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤)
–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏: ¬´—É—á–µ–Ω–∏–∫ –ø–æ –∫–ª–∏–∫—É¬ª, ¬´–∞–≤—Ç–æ–ø–∏–ª–æ—Ç PEMDAS¬ª, ¬´–∞–≤—Ç–æ–ø–∏–ª–æ—Ç —É—á–µ–±–Ω—ã–π –¥–ª–∏–Ω–Ω—ã–π –ø—É—Ç—å¬ª, ¬´–¥–µ–º–æ-—Ä–µ–∂–∏–º¬ª –∏ —Ç.–ø.

2. –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –º–æ—Å—Ç –∫ –±—ç–∫-—ç–Ω–¥—É

Display Adapter (–∞–¥–∞–ø—Ç–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Üí –¥–∞–Ω–Ω—ã–µ)
–ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —É–¥–æ–±–Ω—É—é –¥–ª—è Viewer, –∏ –æ–±—Ä–∞—Ç–Ω–æ: —Å–≤—è–∑—ã–≤–∞–µ—Ç —É–∑–ª—ã —Ñ–æ—Ä–º—É–ª—ã —Å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏ —É—á–∞—Å—Ç–∫–∞–º–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ.

ClientEvents Logger (–ª–æ–≥–≥–µ—Ä —Å–æ–±—ã—Ç–∏–π –∫–ª–∏–µ–Ω—Ç–∞)
–°–æ–±–∏—Ä–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è —É—á–µ–Ω–∏–∫–∞ (–∫–ª–∏–∫–∏, –≤—ã–±–æ—Ä –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤) –≤ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –Ω–∞ –±—ç–∫-—ç–Ω–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏.

HTTP Client (–∫–ª–∏–µ–Ω—Ç –±—ç–∫-—ç–Ω–¥–∞)
–£–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ –±—ç–∫-—ç–Ω–¥—É: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â—É—é —Ñ–æ—Ä–º—É–ª—É, –≤—ã–¥–µ–ª–µ–Ω–∏–µ, —Ä–µ–∂–∏–º, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –ø–æ–ª—É—á–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –Ω–æ–≤—ã–µ —à–∞–≥–∏, –∫–∞—Ä—Ç—É, –ø–æ–¥—Å–∫–∞–∑–∫–∏.

3. Backend API v1 (HTTP-—Å–ª–æ–π)

HTTP Server / Router (—Å–µ—Ä–≤–µ—Ä –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä)
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã –æ—Ç —Ñ—Ä–æ–Ω—Ç-—ç–Ω–¥–∞, –ø–æ URL —Ä–µ—à–∞–µ—Ç, –∫–∞–∫–æ–π —Å–µ—Ä–≤–∏—Å –≤—ã–∑—ã–≤–∞—Ç—å (engine-step, mapmaster-introspect –∏ —Ç.–ø.), –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –≤ JSON.

Endpoint /api/engine-step
–ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ñ–æ—Ä–º—É–ª—É –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —à–∞–≥, –ø–µ—Ä–µ–¥–∞—ë—Ç –∏—Ö –≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä/–¥–≤–∏–∂–æ–∫ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—É—é —Ñ–æ—Ä–º—É–ª—É –∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–¥–µ–ª–∞–Ω–Ω–æ–≥–æ —à–∞–≥–∞.

Endpoint /api/mapmaster-introspect
–ü–æ–ª—É—á–∞–µ—Ç —Ñ–æ—Ä–º—É–ª—É –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ, –ø—Ä–æ—Å–∏—Ç MapMaster –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Ä—Ç—É –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ—ë –¥–ª—è –¥–µ–±–∞–≥–∞ –∏ —É—á–µ–±–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞.

Health/Debug Endpoints (–∑–¥–æ—Ä–æ–≤—å–µ/–æ—Ç–ª–∞–¥–∫–∞)
–î–∞—é—Ç –ø—Ä–æ—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∂–∏–≤, –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫—Ä–∞—Ç–∫—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

4. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —à–∞–≥–æ–≤ –Ω–∞ –±—ç–∫-—ç–Ω–¥–µ

EngineStepOrchestrator (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —à–∞–≥–∞)
–°–æ–±–∏—Ä–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–¥–Ω–æ–≥–æ —à–∞–≥–∞: –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ—Ç API, —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç MapMaster/StepMaster, –∫–∞–∫–æ–π —à–∞–≥ –≤—ã–ø–æ–ª–Ω–∏—Ç—å, –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω—É–∂–Ω—ã–π –ø—Ä–∏–º–∏—Ç–∏–≤ –≤ –¥–≤–∏–∂–∫–µ –∏ —É–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –æ—Ç–≤–µ—Ç.

PrimitiveRunner (–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤)
–ë–µ—Ä—ë—Ç —Ñ–æ—Ä–º—É–ª—É –∏ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–∏–º–∏—Ç–∏–≤ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —ç—Ç–æ—Ç –æ–¥–∏–Ω –∞—Ç–æ–º–∞—Ä–Ω—ã–π —à–∞–≥ –≤ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —è–¥—Ä–µ. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏–±–æ –Ω–æ–≤—É—é —Ñ–æ—Ä–º—É–ª—É, –ª–∏–±–æ —Å–∏–≥–Ω–∞–ª ¬´—Ö–æ–¥ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω¬ª.

MapMaster (–∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ —à–∞–≥–æ–≤)
–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–∞—Ä—Ç—É –≤—Å–µ—Ö –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ö–æ–¥–æ–≤ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –º–µ—Å—Ç–∞–º –≤ —Ñ–æ—Ä–º—É–ª–µ.

StepMaster (—Ä–µ–∂–∏—Å—Å—ë—Ä —Ä–µ—à–µ–Ω–∏—è)
–ë–µ—Ä—ë—Ç –∫–∞—Ä—Ç—É —Ö–æ–¥–æ–≤ –æ—Ç MapMaster –∏ ‚Äî –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ (–ø–æ –∫–ª–∏–∫—É —É—á–µ–Ω–∏–∫–∞ –∏–ª–∏ –∞–≤—Ç–æ–ø–∏–ª–æ—Ç) ‚Äî –≤—ã–±–∏—Ä–∞–µ—Ç –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

Scenario / Strategy Registry (—Ä–µ–µ—Å—Ç—Ä —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)
–•—Ä–∞–Ω–∏—Ç –æ–ø–∏—Å–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π: –¥–ª–∏–Ω–Ω—ã–π —É—á–µ–±–Ω—ã–π –ø—É—Ç—å, —Å—Ç—Ä–æ–≥–∏–π PEMDAS, —É–ø—Ä–æ—â–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã, —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Ç–µ–º –∏ —É—Ä–æ–∫–æ–≤. –î–∞—ë—Ç StepMaster –≥–æ—Ç–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ —à–∞–≥–æ–≤.

Invariant / Rule Set Registry (–Ω–∞–±–æ—Ä—ã –ø—Ä–∞–≤–∏–ª –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
–•—Ä–∞–Ω–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫—É—Ä—Å–æ–≤: –∫–∞–∫–∏–µ —Ç–∏–ø—ã —à–∞–≥–æ–≤ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã, –∫–∞–∫–∏–µ —Å–∫—Ä—ã—Ç—ã, –∫–∞–∫–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —É—Ä–æ–≤–Ω–µ/—Ç–µ–º–µ. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å –≥—Ä—É–ø–ø—ã —à–∞–≥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Å–µ ¬´–º–∞–∫—Ä–æ¬ª-—à–∞–≥–∏).

5. –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ (engine / NGIN)

AST Core (–¥–µ—Ä–µ–≤–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è)
–•—Ä–∞–Ω–∏—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ –≤–∏–¥–µ –¥–µ—Ä–µ–≤–∞: —á–∏—Å–ª–∞, –∑–Ω–∞–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π, –¥—Ä–æ–±–∏, —Å–∫–æ–±–∫–∏. –î–∞—ë—Ç —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ —á–∏—Ç–∞—Ç—å –∏ –º–µ–Ω—è—Ç—å —Ñ–æ—Ä–º—É–ª—É.

Parser (–ø–∞—Ä—Å–µ—Ä —Ñ–æ—Ä–º—É–ª)
–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∑–∞–ø–∏—Å—å —Ñ–æ—Ä–º—É–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ LaTeX –∏–ª–∏ –¥—Ä—É–≥–æ–º —Ñ–æ—Ä–º–∞—Ç–µ) –≤ AST-–¥–µ—Ä–µ–≤–æ, —Å –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–≤–∏–∂–æ–∫.

Printer (–ø–µ—á–∞—Ç—å —Ñ–æ—Ä–º—É–ª)
–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç AST-–¥–µ—Ä–µ–≤–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å—Ç—Ä–æ–∫—É (LaTeX –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç), —á—Ç–æ–±—ã —Ñ—Ä–æ–Ω—Ç-—ç–Ω–¥ –º–æ–≥ –∫—Ä–∞—Å–∏–≤–æ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é —Ñ–æ—Ä–º—É–ª—É.

Primitive Table (—Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤)
–Ø–≤–ª—è–µ—Ç—Å—è –æ–±—â–∏–º —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º –≤—Å–µ—Ö –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö —à–∞–≥–æ–≤: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–º–∏—Ç–∏–≤–∞ —Ö—Ä–∞–Ω–∏—Ç, –∫–∞–∫–æ–π —É—á–∞—Å—Ç–æ–∫ –¥–µ—Ä–µ–≤–∞ –æ–Ω —É–º–µ–µ—Ç –º–µ–Ω—è—Ç—å –∏ –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –æ–Ω —ç—Ç–æ –¥–µ–ª–∞–µ—Ç.

Primitive Engine (—è–¥—Ä–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤)
–†–µ–∞–ª–∏–∑—É–µ—Ç —Å–∞–º–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è: –ø—Ä–∏–º–µ–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–∏–º–∏—Ç–∏–≤ –∫ AST, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤–æ–µ AST –ø–æ—Å–ª–µ —à–∞–≥–∞.

Value / Checkers (–ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π)
–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã—á–∏—Å–ª–∏—Ç—å —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ø–æ—Å–ª–µ —à–∞–≥–∞ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —à–∞–≥–æ–≤).

6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç–µ—Å—Ç—ã –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —á–∞—Å—Ç–∏

Step Log / SRP Log (–∂—É—Ä–Ω–∞–ª —à–∞–≥–æ–≤)
–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏: –∫–∞–∫–æ–π –±—ã–ª –∑–∞–ø—Ä–æ—Å, –∫–∞–∫–æ–π –ø—Ä–∏–º–∏—Ç–∏–≤ –ø—Ä–∏–º–µ–Ω–∏–ª–∏, –∫–∞–∫–æ–π –æ—Ç–≤–µ—Ç –≤–µ—Ä–Ω—É–ª –¥–≤–∏–∂–æ–∫. –ü–æ–º–æ–≥–∞–µ—Ç —Ä–∞–∑–±–∏—Ä–∞—Ç—å –æ—à–∏–±–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ —É—á–µ–Ω–∏–∫–∏ —Ä–µ—à–∞—é—Ç –∑–∞–¥–∞—á–∏.

Unit / Integration Tests (—Ç–µ—Å—Ç—ã)
–ù–∞–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –∏ –¥–ª—è –≤—Å–µ–≥–æ –ø—É—Ç–∏ ¬´–æ—Ç –∫–ª–∏–∫–∞ —É—á–µ–Ω–∏–∫–∞ –¥–æ –Ω–æ–≤–æ–π —Ñ–æ—Ä–º—É–ª—ã¬ª, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –≤–µ–¥—ë—Ç —Å–µ–±—è —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.

Demo / Playground Servers (–¥–µ–º–æ-—Å—Ç—Ä–∞–Ω–∏—Ü—ã)
–ù–µ–±–æ–ª—å—à–∏–µ —Å—Ç–µ–Ω–¥—ã, –≥–¥–µ –º–æ–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ—Ç—ã–∫–∞—Ç—å –¥–≤–∏–∂–æ–∫, MapMaster, StepMaster –∏ API, –Ω–µ –∑–∞—Ö–æ–¥—è –≤ –ø–æ–ª–Ω—ã–π —É—á–µ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –£–ø—Ä–æ—â–∞—é—Ç –æ—Ç–ª–∞–¥–∫—É –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.


1. –¢–ó –Ω–∞ backend –≤ —Ü–µ–ª–æ–º
1.1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Backend ‚Äî —ç—Ç–æ –æ–¥–Ω–æ—à–∞–≥–æ–≤—ã–π –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫ –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Motor:

–ù–∞ –≤—Ö–æ–¥ –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Äú—Å–¥–µ–ª–∞–π –æ–¥–∏–Ω —É—á–µ–±–Ω—ã–π —à–∞–≥‚Äù –Ω–∞–¥ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º (–≤ LaTeX), —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–ª–∏–∫–µ/–≤—ã–¥–µ–ª–µ–Ω–∏–∏ –∏ —Ç–µ–∫—É—â–µ–π —É—á–µ–±–Ω–æ–π —Å–µ—Å—Å–∏–∏.

–í–Ω—É—Ç—Ä–∏ –æ–Ω:

–°—Ç—Ä–æ–∏—Ç –∫–∞—Ä—Ç—É –≤–æ–∑–º–æ–∂–Ω—ã—Ö —à–∞–≥–æ–≤ (MapMaster).

–í—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–π —à–∞–≥ –ø–æ —É—á–µ–±–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–µ (StepMaster).

–ò—Å–ø–æ–ª–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —à–∞–≥ –Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–º –¥–≤–∏–∂–∫–µ (Engine —á–µ—Ä–µ–∑ Engine Bridge).

–ù–∞ –≤—ã—Ö–æ–¥ –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–≥–æ –æ–¥–∏–Ω —à–∞–≥ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏: –æ—Ç fromLatex –∫ toLatex, —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ –ø—Ä–∏–º–∏—Ç–∏–≤–∞ –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π –∏ —Å–ª—É–∂–µ–±–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.

Backend –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:

–°—Ç–∞—Çeless –ø–æ HTTP: –≤—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —à–∞–≥–∞, –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –∑–∞–ø—Ä–æ—Å–µ (sessionId, history –∏ —Ç.–ø.).

–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º: –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç.

–†–∞—Å—à–∏—Ä—è–µ–º—ã–º: –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤/–ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ –∏ –æ–±–ª–∞—Å—Ç–∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏, –Ω–µ –ª–æ–º–∞—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API.

1.2. –ì—Ä–∞–Ω–∏—Ü—ã –∏ –æ—Å–Ω–æ–≤–Ω–æ–π HTTP-–∫–æ–Ω—Ç—Ä–∞–∫—Ç

–û—Å–Ω–æ–≤–Ω–æ–π –≤–Ω–µ—à–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Äî HTTP-—Å–µ—Ä–≤–µ—Ä @motor/backend-api-v1-http-server —Å –æ–¥–Ω–∏–º –∫–ª—é—á–µ–≤—ã–º endpoint:

POST /entry/step (–≤ —Ç–µ–∫—É—â–µ–º –∫–æ–¥–µ —É–∂–µ –µ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è HTTP/handler/CLI –¥–ª—è –±–ª–∏–∑–∫–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, —Ä–∞–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è /engine/step).

–ó–∞–ø—Ä–æ—Å (EngineStepRequest v1):

expressionId: string ‚Äî ID –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Ñ—Ä–æ–Ω—Ç–∞.

sessionId: string ‚Äî ID —É—á–µ–±–Ω–æ–π —Å–µ—Å—Å–∏–∏ (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —à–∞–≥–æ–≤).

mode: "preview" | "commit" ‚Äî ‚Äú–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä‚Äù —à–∞–≥–∞ –∏–ª–∏ ‚Äú–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å‚Äù.

latex: string ‚Äî –∏—Å—Ö–æ–¥–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (–≤ LaTeX).

invariantSetId: string ‚Äî –∫–∞–∫–æ–π –Ω–∞–±–æ—Ä —É—á–µ–±–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, "fractions-basic.v1").

clientEvent: { ... } ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–∫–µ/–∂–µ—Å—Ç–µ (—Ç–∏–ø, surfaceNodeId, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ —Ç.–ø.).

history?: StepHistoryDTO ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —É–∂–µ —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö —à–∞–≥–æ–≤ (–¥–ª—è StepMaster).

options?: { maxDepth?: number; debug?: boolean; } ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

–û—Ç–≤–µ—Ç (EngineStepResponse v1):

status: "ok" | "noStep" | "error".

–û–±—â–∏–µ –ø–æ–ª—è:

expressionId: string

sessionId: string

requestId: string ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID –∑–∞–ø—Ä–æ—Å–∞.

–î–ª—è status: "ok":

fromLatex: string

toLatex: string

appliedPrimitiveId: string ‚Äî ID –ø—Ä–∏–º–∏—Ç–∏–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, P4.FRAC_ADD_BASIC).

invariantSetId: string

invariantRuleId?: string

stepId: string ‚Äî ID —à–∞–≥–∞ –≤–Ω—É—Ç—Ä–∏ —Å–µ—Å—Å–∏–∏.

debug?: { mapMaster?: ..., stepMaster?: ... } ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞.

–î–ª—è status: "noStep":

reasonCode: string (–Ω–∞–ø—Ä–∏–º–µ—Ä, "NO_MATCHING_RULE", "MAX_STEPS_REACHED").

messages: { code: string; text: string; level: "info" | "warning" }[].

–î–ª—è status: "error":

errorCode: string

message: string

details?: unknown.

1.3. –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã backend‚Äô–∞

–õ–æ–≥–∏—á–µ—Å–∫–∏–µ —Å–ª–æ–∏:

Transport / HTTP —Å–ª–æ–π

–§–∞–π–ª—ã: engineHttpServer.ts, HandlerPostEntryStep.ts, cliEngineHttpServer.ts.

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ HTTP, –≤–∞–ª–∏–¥–∞—Ü–∏—é JSON, –º–∞–ø–ø–∏–Ω–≥ –≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ç–∏–ø—ã.

–ü—Ä–æ—Ç–æ–∫–æ–ª —à–∞–≥–∞ (types)

–§–∞–π–ª: src/protocol/backend-step.types.ts.

–û–ø–∏—Å—ã–≤–∞–µ—Ç EngineStepRequest, EngineStepResponse, —Å—Ç–∞—Ç—É—Å—ã –∏ –±–∞–∑–æ–≤—ã–µ DTO.

–°–µ—Ä–≤–∏—Å ‚Äú–°–¥–µ–ª–∞–π —à–∞–≥‚Äù (Orchestrator + PrimitiveRunner)

–§–∞–π–ª—ã: EngineStepOrchestrator.ts, PrimitiveRunner.ts, PrimitiveRunner.ngin.ts.

–°–≤—è–∑—ã–≤–∞–µ—Ç MapMaster, StepMaster –∏ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫.

MapMaster

–°–µ—Ä–≤–∏—Å, —Å—Ç—Ä–æ—è—â–∏–π –∫–∞—Ä—Ç—É –≤–æ–∑–º–æ–∂–Ω—ã—Ö —à–∞–≥–æ–≤ –Ω–∞–¥ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ AST/LaTeX, –≤—ã–¥–µ–ª–µ–Ω–∏—è, –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.

StepMaster

–°–µ—Ä–≤–∏—Å, –≤—ã–±–∏—Ä–∞—é—â–∏–π –ª—É—á—à–∏–π —à–∞–≥ –∏–∑ –∫–∞—Ä—Ç—ã, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –∏—Å—Ç–æ—Ä–∏—é –∏ —É—á–µ–±–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É.

Registry –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤

–•—Ä–∞–Ω–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤; –¥–∞—ë—Ç –∏—Ö MapMaster/Engine Bridge.

Engine Bridge + NGIN (math core)

–ú–æ—Å—Ç –æ—Ç EngineRequestDraft (–∏–∑ MapMaster) –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞ (NGIN-lite, CAS –∏ —Ç.–ø.).

–°–∞–º–æ —è–¥—Ä–æ –º–æ–∂–µ—Ç –∂–∏—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–∞–∫–µ—Ç–µ.

2. –¢–ó –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º
2.1. HTTP –ø–∞–∫–µ—Ç @motor/backend-api-v1-http-server
2.1.1. –ü—Ä–æ—Ç–æ–∫–æ–ª —à–∞–≥–æ–≤ (backend-step.types.ts)

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –µ–¥–∏–Ω—ã–π —Ç–∏–ø–æ–≤–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–µ–∂–¥—É —Ñ—Ä–æ–Ω—Ç–æ–º –∏ backend‚Äô–æ–º –∏ –≤–Ω—É—Ç—Ä–∏ backend‚Äô–∞.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å:

EngineStepRequest

EngineStepResponseOk, EngineStepResponseNoStep, EngineStepResponseError

–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ EngineStepResponse.

–¢–∏–ø—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å—Ç—ã–º–∏ DTO (–Ω–µ—Ç –º–µ—Ç–æ–¥–æ–≤, —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ).

–ß—ë—Ç–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

latex ‚Äî –Ω–µ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞.

expressionId, sessionId, invariantSetId ‚Äî –Ω–µ–ø—É—Å—Ç—ã–µ.

–û—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–ª—è:

ClientEvent (—Ç–∏–ø, surfaceNodeId, selection, modifiers).

StepHistoryDTO (—Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤: stepId, candidateId, invariantId, timestamp, outcome).

2.1.2. HTTP-—Å–µ—Ä–≤–µ—Ä (engineHttpServer.ts)

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø–æ–¥–Ω—è—Ç—å HTTP-—Å–µ—Ä–≤–µ—Ä, –ø–æ–≤–µ—Å–∏—Ç—å endpoint –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å handler.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–±—Ä–∏–∫—É:

export interface EngineHttpServerOptions {
  port: number;
  handlerDeps: HandlerPostEntryStepDeps;
  logger?: LoggerLike;
}
export function createEngineHttpServer(options: EngineHttpServerOptions): HttpServer;


–≠–Ω–¥–ø–æ–∏–Ω—Ç v1: POST /entry/step.

–ü–æ–≤–µ–¥–µ–Ω–∏–µ:

–ß–∏—Ç–∞–µ—Ç JSON, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–æ EngineStepRequest.

–ü—Ä–∏ –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 –∏ EngineStepResponseError —Å errorCode = "BAD_REQUEST".

–ù–∞ —É—Å–ø–µ—Ö ‚Äî –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤ HandlerPostEntryStep.

2.1.3. HTTP-handler (HandlerPostEntryStep.ts)

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Å–≤—è–∑–∞—Ç—å HTTP —Å Orchestrator.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

export interface HandlerPostEntryStepDeps {
  performStep: (req: EngineStepRequest) => Promise<EngineStepResponse>;
  logger?: LoggerLike;
}


–§—É–Ω–∫—Ü–∏—è:

export function createHandlerPostEntryStep(deps: HandlerPostEntryStepDeps): ExpressHandler;


–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏:

–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (—Ç–∏–ø/–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è).

–ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ (—á–∏—Å–ª–∞/—Å—Ç—Ä–æ–∫–∏, fallback –∑–Ω–∞—á–µ–Ω–∏–π).

–í—ã–∑–æ–≤ performStep.

–ú–∞–ø–ø–∏–Ω–≥ EngineStepResponse ‚Üí HTTP-–æ—Ç–≤–µ—Ç (200 –¥–ª—è –≤—Å–µ—Ö —Ç—Ä—ë—Ö —Å—Ç–∞—Ç—É—Å–æ–≤, –æ—à–∏–±–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ ‚Äî 5xx).

–ó–∞–ø—Ä–µ—â–µ–Ω–æ: –≤–Ω—É—Ç—Ä–∏ handler —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ —à–∞–≥–∞; —ç—Ç–æ —Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç.

2.1.4. CLI entrypoint (cliEngineHttpServer.ts)

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

–ß–∏—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (port, env).

–°–æ–∑–¥–∞—ë—Ç:

primitiveRunnerDeps = createNginPrimitiveRunnerDeps().

mapMaster = new BasicMapMaster(...).

stepMaster = new BasicStepMaster(...).

orchestratorDeps = { primitiveRunnerDeps, mapMaster, stepMaster, engineBridge, invariantsRegistry }.

–ü–æ–¥–Ω–∏–º–∞–µ—Ç HTTP-—Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ createEngineHttpServer.

2.2. Orchestrator + PrimitiveRunner
2.2.1. EngineStepOrchestrator

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ–¥–∏–Ω –≤—Ö–æ–¥ ‚Äî EngineStepRequest, –æ–¥–∏–Ω –≤—ã—Ö–æ–¥ ‚Äî EngineStepResponse; –Ω–∏–∫–∞–∫–∏—Ö HTTP-–¥–µ—Ç–∞–ª–µ–π.

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

export interface EngineStepOrchestratorDeps {
  mapMaster: MapMaster;
  stepMaster: StepMaster;
  primitiveRunner: PrimitiveRunner;
  engineBridge: EngineBridge;
  invariantsRegistry: InvariantsRegistry;
}

export function performStepWithOrchestrator(
  request: EngineStepRequest,
  deps: EngineStepOrchestratorDeps,
): Promise<EngineStepResponse>;


–ü–æ–≤–µ–¥–µ–Ω–∏–µ:

–í–∞–ª–∏–¥–∞—Ü–∏—è/–æ–±–æ–≥–∞—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ (–¥–æ–±–∞–≤–∏—Ç—å requestId, sessionId, —Ç–∞–π–º—Å—Ç–µ–º–ø—ã).

–í—ã–∑–≤–∞—Ç—å mapMaster.planStep(...) ‚Üí MapMasterPlan.

–ù–∞ –æ—Å–Ω–æ–≤–µ history/policy –≤—ã–∑–≤–∞—Ç—å stepMaster.chooseStep(...) ‚Üí StepMasterResult.

–ï—Å–ª–∏ status === "noCandidates":

–í–µ—Ä–Ω—É—Ç—å EngineStepResponseNoStep.

–ï—Å–ª–∏ status === "scoringFailed":

–í–µ—Ä–Ω—É—Ç—å EngineStepResponseError (errorCode = "STEPMASTER_FAILED").

–ï—Å–ª–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç –≤—ã–±—Ä–∞–Ω:

–° –ø–æ–º–æ—â—å—é engineBridge —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å EngineExecutionRequest –¥–ª—è –¥–≤–∏–∂–∫–∞ –∏–∑ candidate.engineRequest.

–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏–º–∏—Ç–∏–≤ —á–µ—Ä–µ–∑ primitiveRunner/–¥–≤–∏–∂–æ–∫.

–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å EngineStepResponseOk (from/toLatex, appliedPrimitiveId, invariantRuleId).

–í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≤–∏—Ç—å –∏ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –≤ EngineStepResponseError.

2.2.2. PrimitiveRunner + PrimitiveRunner.ngin

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π adapter ‚Äú–æ–¥–∏–Ω —à–∞–≥ –≤ –¥–≤–∏–∂–∫–µ‚Äù.

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å PrimitiveRunner:

export interface PrimitiveRunner {
  runPrimitiveStep(req: EngineExecutionRequest): Promise<EngineExecutionResult>;
}


NGIN-–≤–∞—Ä–∏–∞–Ω—Ç (PrimitiveRunner.ngin.ts):

–ò–º–µ–µ—Ç NginPrimitiveRunnerDeps —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ parseLatexToAst, applyPrimitives, printAstToLatex.

–ì–∞—Ä–∞–Ω—Ç–∏–∏:

–ù–µ –±—Ä–æ—Å–∞–µ—Ç uncaught –∏—Å–∫–ª—é—á–µ–Ω–∏—è; –æ—à–∏–±–∫–∏ ‚Üí EngineExecutionResult.error.

–†–∞–±–æ—Ç–∞–µ—Ç —á–∏—Å—Ç–æ: –Ω–µ –º–µ–Ω—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

2.3. MapMaster

(—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç mapmaster.core.ts + rule provider)

2.3.1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–°—Ç—Ä–æ–∏—Ç –∫–∞—Ä—Ç—É –≤–æ–∑–º–æ–∂–Ω—ã—Ö —à–∞–≥–æ–≤ –¥–ª—è –æ–¥–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ –æ–¥–Ω–æ–≥–æ –∫–ª–∏–∫–∞/–≤—ã–¥–µ–ª–µ–Ω–∏—è.

2.3.2. –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã

MapMasterRequest:

mode: "preview" | "apply" | "explain"

expression: { id, latex, invariantSetId, engineView? }

clientEvent: MapMasterClientEvent

tsaSelection: TsaSelectionInfo

policy: MapMasterPolicy { stepLevel, allowMultipleSteps, maxCandidates }

MapMasterStepCandidate:

id: string

kind: string (—Ç–∏–ø —à–∞–≥–∞: fraction/add, fraction/simplify –∏ —Ç.–ø.)

invariantId: string

selection: { surfaceRegionIds: SurfaceRegionId[]; tsaRegionIds: TsaRegionId[] }

engineRequest: EngineRequestDraft (—á—Ç–æ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–≤–∏–∂–∫—É)

description, safety.

MapMasterPlan:

requestId, sessionId, expressionId, engineTarget

candidates: MapMasterStepCandidate[]

messages: MapMasterMessage[]

chosenStepId?: string (MapMaster –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –≤—ã–±–∏—Ä–∞–µ—Ç, –æ—Å—Ç–∞–≤–ª—è–µ–º undefined).

2.3.3. MapMaster core (BasicMapMaster)

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ–±—â–∏–π skeleton, –Ω–µ –∑–∞–≤–∏—Å—è—â–∏–π –æ—Ç –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

–ò–º–µ–µ—Ç MapMasterRuleProvider, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî ‚Äú–Ω–∞–≤—ã–∫–∏–Ω—É—Ç—å‚Äù —Å—ã—Ä—ã–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã.

–ó–∞–¥–∞—á–∏ core:

–í—ã—á–∏—Å–ª–∏—Ç—å effectiveMaxCandidates –∏–∑ policy.maxCandidates + fallback + hard-limit, —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏ (INVALID_MAX_CANDIDATES, MAX_CANDIDATES_CLAMPED).

–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ candidate.id + –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ DUPLICATE_CANDIDATE_IDS.

–û–±—Ä–µ–∑–∫–∞ –º–∞—Å—Å–∏–≤–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–æ limit —Å CANDIDATES_TRUNCATED.

–ï—Å–ª–∏ –∏—Ç–æ–≥–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç ‚Äî –¥–æ–±–∞–≤–∏—Ç—å NO_CANDIDATES.

–í—ã—Ö–æ–¥ ‚Äî MapMasterPlan.

2.3.4. Rule Providers

–û—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏:

FractionsRuleProvider ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –¥—Ä–æ–±–µ–π (—Ä–∞–∑–±–æ—Ä a/b, a/b + c/d, —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ, –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –æ–±—â–µ–º—É –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—é –∏ —Ç.–ø.).

–í –±—É–¥—É—â–µ–º: IntegersRuleProvider, AlgebraRuleProvider –∏ —Ç.–¥.

–ö–∞–∂–¥—ã–π provider:

–ò–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ Invariants Registry (–ø–æ invariantSetId).

–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ AST/LaTeX + —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤.

2.4. StepMaster

(—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç stepmaster.core.ts + stepmaster.policy.ts + scoring-service + introspection)

2.4.1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ò–∑ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ MapMaster –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –ª—É—á—à–∏–π —à–∞–≥ –ø–æ —É—á–µ–±–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–µ, —É—á–∏—Ç—ã–≤–∞—è:

–∫—É–¥–∞ –∫–ª–∏–∫–Ω—É–ª —Å—Ç—É–¥–µ–Ω—Ç,

–∏—Å—Ç–æ—Ä–∏—é –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —à–∞–≥–æ–≤,

–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äú–º–∏–∫—Ä–æ/–Ω–æ—Ä–º–∞–ª—å–Ω—ã–π/–º–∞–∫—Ä–æ‚Äù –∏ —Ç.–ø.

2.4.2. –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã

StepMasterInput:

expression: { expressionId, latex, invariantSetId, engineView? }

plan: MapMasterPlan

history: StepHistory

clientEvent: StepMasterClientEvent

policy: StepPolicyContext { config: StepPolicyConfig, currentStepIndex, totalStepsDone }

selection?: StepSelectionContext.

StepMasterResult:

status: "ok" | "noCandidates" | "scoringFailed"

chosenCandidate?: MapMasterStepCandidate

choice?: { candidateId; totalScore; flags: StepReasonCode[] }

scores: CandidateScoreDetail[]

messages: StepMasterMessage[].

2.4.3. StepMaster core (BasicStepMaster)

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

–ó–∞–≤–∏—Å–∏—Ç –æ—Ç StepScoringService (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∞ –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è).

–ê–ª–≥–æ—Ä–∏—Ç–º:

–ï—Å–ª–∏ plan.candidates.length === 0 ‚Üí status = "noCandidates", NO_CANDIDATES.

–í—ã–∑—ã–≤–∞–µ—Ç scoringService.scoreAllCandidates(input):

–û—à–∏–±–∫–∞ ‚Üí status = "scoringFailed", SCORING_FAILED.

–°–æ—Ä—Ç–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ scoringService.sortCandidatesByScore.

–ë–µ—Ä—ë—Ç –ø–µ—Ä–≤–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ (–ø–æ–±–µ–¥–∏—Ç–µ–ª—è); –µ—Å–ª–∏ totalScore –Ω–∏–∂–µ minTotalScoreToChoose (–æ–ø—Ü–∏—è), —Ç–æ LOW_SCORE_NO_CHOICE –∏ status = "noCandidates".

–ï—Å–ª–∏ candidateId –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ plan.candidates ‚Üí WINNER_CANDIDATE_NOT_FOUND, status = "scoringFailed".

–ò–Ω–∞—á–µ ‚Äî status = "ok", STEP_CHOSEN.

2.4.4. Scoring policy (stepmaster.policy.ts + adapter)

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è.

–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

BaseScore –∑–∞–≤–∏—Å–∏—Ç –æ—Ç granularity (‚Äúmicro‚Äù/‚Äúnormal‚Äù/‚Äúmacro‚Äù).

ClickScore:

–ø—Ä—è–º–∞—è —Å–≤—è–∑—å –∫–ª–∏–∫–∞ —Å –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–º (direct) ‚Üí –≤—ã—Å–æ–∫–∏–π –±–æ–Ω—É—Å;

–∫–æ—Å–≤–µ–Ω–Ω–∞—è (indirect) ‚Üí –º–µ–Ω—å—à–∏–π –±–æ–Ω—É—Å;

–ø—Ä–∏ preferClickedRegion = false ‚Äî —à—Ç—Ä–∞—Ñ/–ø–æ–ª–æ–≤–∏–Ω–Ω—ã–π –≤–µ—Å.

HistoryScore:

—Å–∏–ª—å–Ω—ã–π —à—Ç—Ä–∞—Ñ –∑–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —Ç–æ–≥–æ –∂–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ (flag HISTORY_REPEAT_CANDIDATE);

–º–µ–Ω—å—à–∏–π —à—Ç—Ä–∞—Ñ –∑–∞ –ø–æ–≤—Ç–æ—Ä —Ç–æ–≥–æ –∂–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞ (HISTORY_REPEAT_INVARIANT);

–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π ‚Äúfatigue penalty‚Äù –∑–∞ —á–∞—Å—Ç—ã–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è.

InvariantScore ‚Äî –∑–∞–¥–µ–ª –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É –ø—Ä–∞–≤–∏–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚Äú—Å–Ω–∞—á–∞–ª–∞ —É–ø—Ä–æ—Å—Ç–∏—Ç—å, –ø–æ—Ç–æ–º –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –æ–±—â–µ–º—É –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—é‚Äù).

Adapter (stepmaster.scoring-service.ts) –ø—Ä–æ—Å—Ç–æ –º–æ—Å—Ç–∏—Ç —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å StepScoringService.

2.4.5. Introspection / History

–û—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

StepMasterHistoryService ‚Äî —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Å—Ç–æ—Ä–∏–µ–π —à–∞–≥–æ–≤ (—Å–æ–∑–¥–∞—ë—Ç StepHistory –∏–∑ sessionId + —Å–ø–∏—Å–∫–∞ —à–∞–≥–æ–≤).

Introspect (stepmaster.introspect.ts) ‚Äî –∏–∑ StepMasterInput –∏ StepMasterResult —Å—Ç—Ä–æ–∏—Ç –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π JSON –¥–ª—è –ª–æ–≥–æ–≤/teacher-–ø–∞–Ω–µ–ª–∏ (—Å—Ç–∞—Ç—É—Å—ã, —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ —Å –±–∞–ª–ª–∞–º–∏, —Å–æ–æ–±—â–µ–Ω–∏—è).

2.5. Registry –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤
2.5.1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –æ:

–Ω–∞–±–æ—Ä–∞—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, fractions-basic.v1),

–ø—Ä–∞–≤–∏–ª–∞—Ö (InvariantRule),

–ø—Ä–∏–º–∏—Ç–∏–≤–∞—Ö (PrimitiveDefinition –∏ –∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö).

2.5.2. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ú–æ–¥–µ–ª—å:

InvariantSet:

id: InvariantSetId

title, description

rules: InvariantRule[]

primitives: PrimitiveDefinition[].

InvariantRule:

id: string

scope: "fraction" | "integer" | ...

descriptionStudent, descriptionTeacher

—Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–∏–º–∏—Ç–∏–≤—ã.

PrimitiveDefinition:

id: PrimitiveId (–ø—Ä–∏–º–µ—Ä: P4.FRAC_ADD_BASIC)

engineOperationId: string ‚Äî –∫–∞–∫ —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –¥–≤–∏–∂–∫–µ

arity, applicableTo (—Ç–∏–ø AST-–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤)

labels/–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

API:

–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–±–æ—Ä–∞ –ø–æ invariantSetId.

–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª/–ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ –ø–æ ID.

–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (–Ω–µ—Ç –≤–∏—Å—è—á–∏—Ö —Å—Å—ã–ª–æ–∫, —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ ID, –∏ —Ç.–ø.).

MapMaster –∏ Engine Bridge –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —à—å—é—Ç –ø—Ä–∞–≤–∏–ª–∞ ‚Äú–≤ –∫–æ–¥–µ‚Äù ‚Äî –≤—Å—ë –∏–¥—ë—Ç —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç Registry.

2.6. Engine Bridge + Math Engine
2.6.1. Engine Bridge

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Å–≤—è–∑—ã–≤–∞–µ—Ç MapMasterStepCandidate.engineRequest —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≤—ã–∑–æ–≤–æ–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

–ú–æ–¥–µ–ª—å EngineExecutionRequest:

operation: string (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç engineOperationId –∏–∑ PrimitiveDefinition),

operands: EngineAstNode[] –∏–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —É—á–∞—Å—Ç–∫–æ–≤ AST,

context: { invariantRuleId, metadata... }.

Bridge:

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ candidate.engineRequest –≤–∞–ª–∏–¥–µ–Ω –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.

–°—Ç—Ä–æ–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π EngineExecutionRequest (AST + –æ–ø–µ—Ä–∞—Ü–∏—è).

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã/–æ—à–∏–±–∫–∏ –¥–≤–∏–∂–∫–∞ –∏ –º–∞–ø–∏—Ç –∏—Ö –≤ EngineExecutionResult.

2.6.2. Math Engine (NGIN-lite)

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É:

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –Ω–µ –∑–∞–≤—è–∑–∞–Ω–Ω—ã–π –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:

export interface MathEngine {
  execute(req: EngineExecutionRequest): Promise<EngineExecutionResult>;
}


–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–∞–±–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–π, –æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤ Registry.

–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:

–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å;

–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤;

—á—ë—Ç–∫–∏–µ –æ—à–∏–±–∫–∏ –¥–ª—è ‚Äú–Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö‚Äù –æ–ø–µ—Ä–∞—Ü–∏–π.