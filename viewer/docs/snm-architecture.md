# Surface Node Map (SNM): карта интерактивности и hit‑test
(…см. предыдущий ответ — полный документ включён здесь, в архиве; краткая версия ниже.)

## Ключевые идеи
- DOM‑геометрия как источник истины (работаем по HTML KaTeX).
- Семантический оверлей: `FracBar`, `Decimal`, `MinusUnary/MinusBinary`, `MixedNumber`.
- Попадание: выбираем самый мелкий bbox среди кандидатов.
- Расширенный hit‑box для `FracBar`.
- Пост‑проход `enhanceSurfaceMap` добавляет контекстную семантику без ломки API.

## Конвейер
Render (KaTeX) → Base pass (классификация + bbox) → Enhance (эвристики) → Hit‑test.

## Классификация (база)
- Целые: `Num`, десятичные: `Decimal` (оба атомы).
- Один латинский или греческий символ: `Var` (атом).
- Линия дроби: `FracBar` (атом); `mfrac`: `Fraction` (контейнер).

## Enhance‑эвристики
- Минус: `MinusUnary` или `MinusBinary` по левому соседу (перекрытие по базовой линии).
- Смешанные числа: число перед близкой `FracBar` → `MixedNumber`.

## Hit‑test
Точка → кандидаты из `atoms` по bbox → сортировка по площади → самый мелкий.
Прямоугольник → все bbox целиком внутри прямоугольника.
